{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "cargo-anatomy output",
  "description": "Schema for the JSON/YAML output generated by the cargo-anatomy CLI",
  "type": "object",
  "properties": {
    "meta": { "$ref": "#/definitions/Meta" },
    "crates": {
      "type": "array",
      "items": { "$ref": "#/definitions/CrateOutput" }
    },
    "warnings": { "$ref": "#/definitions/Warnings" }
  },
  "required": ["meta", "crates", "warnings"],
  "definitions": {
    "Metrics": {
      "type": "object",
      "properties": {
        "r": { "type": "integer", "description": "Number of internal class relationships" },
        "n": { "type": "integer", "description": "Number of classes" },
        "h": { "type": "number", "description": "Relational cohesion" },
        "ca": { "type": "integer", "description": "Afferent coupling" },
        "ce": { "type": "integer", "description": "Efferent coupling" },
        "a": { "type": "number", "description": "Abstraction" },
        "i": { "type": "number", "description": "Instability" },
        "d": { "type": "number", "description": "Distance from main sequence" },
        "d_prime": { "type": "number", "description": "Normalized distance from main sequence" }
      },
      "required": ["r", "n", "h", "ca", "ce", "a", "i", "d", "d_prime"],
      "additionalProperties": false
    },
    "Evaluation": {
      "type": "object",
      "properties": {
        "a": { "type": "string", "enum": ["abstract", "mixed", "concrete"] },
        "h": { "type": "string", "enum": ["high", "low"] },
        "i": { "type": "string", "enum": ["stable", "moderate", "unstable"] },
        "d_prime": { "type": "string", "enum": ["good", "balanced", "painful", "useless"] }
      },
      "required": ["a", "h", "i", "d_prime"],
      "additionalProperties": false
    },
    "ClassKind": {
      "type": "string",
      "enum": ["Struct", "Enum", "Trait", "TypeAlias", "Macro"]
    },
    "ClassInfo": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "kind": { "$ref": "#/definitions/ClassKind" }
      },
      "required": ["name", "kind"],
      "additionalProperties": false
    },
    "CrateKind": {
      "type": "string",
      "enum": ["Workspace", "External"]
    },
    "StringArrayMap": {
      "type": "object",
      "additionalProperties": { "type": "array", "items": { "type": "string" } }
    },
    "NestedStringArrayMap": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "additionalProperties": { "type": "array", "items": { "type": "string" } }
      }
    },
    "CrateDetails": {
      "type": "object",
      "properties": {
        "kind": { "$ref": "#/definitions/CrateKind" },
        "classes": {
          "type": "array",
          "items": { "$ref": "#/definitions/ClassInfo" }
        },
        "internal_depends_on": { "$ref": "#/definitions/StringArrayMap" },
        "internal_depended_by": { "$ref": "#/definitions/StringArrayMap" },
        "external_depends_on": { "$ref": "#/definitions/NestedStringArrayMap" },
        "external_depended_by": { "$ref": "#/definitions/NestedStringArrayMap" }
      },
      "required": [
        "kind",
        "classes",
        "internal_depends_on",
        "internal_depended_by",
        "external_depends_on",
        "external_depended_by"
      ],
      "additionalProperties": false
    },
    "CrateOutput": {
      "type": "object",
      "properties": {
        "crate_name": { "type": "string" },
        "metrics": { "$ref": "#/definitions/Metrics" },
        "evaluation": { "$ref": "#/definitions/Evaluation" },
        "details": { "$ref": "#/definitions/CrateDetails" }
      },
      "required": ["crate_name", "metrics", "evaluation"],
      "additionalProperties": false
    },
    "Warnings": {
      "type": "object",
      "properties": {
        "dependency_cycles": {
          "type": "array",
          "items": {
            "type": "array",
            "items": { "type": "string" }
          }
        }
      },
      "required": ["dependency_cycles"],
      "additionalProperties": false
    },
    "Meta": {
      "type": "object",
      "properties": {
        "cargo-anatomy": {
          "type": "object",
          "properties": { "version": { "type": "string" } },
          "required": ["version"],
          "additionalProperties": false
        },
        "config": { "$ref": "#/definitions/Config" }
      },
      "required": ["cargo-anatomy", "config"],
      "additionalProperties": false
    },
    "Config": {
      "type": "object",
      "properties": {
        "evaluation": { "$ref": "#/definitions/EvaluationThresholds" }
      },
      "required": ["evaluation"],
      "additionalProperties": false
    },
    "EvaluationThresholds": {
      "type": "object",
      "properties": {
        "abstraction": { "$ref": "#/definitions/AbstractionThresholds" },
        "cohesion": { "$ref": "#/definitions/CohesionThresholds" },
        "instability": { "$ref": "#/definitions/InstabilityThresholds" },
        "distance": { "$ref": "#/definitions/DistanceThresholds" }
      },
      "required": ["abstraction", "cohesion", "instability", "distance"],
      "additionalProperties": false
    },
    "AbstractionThresholds": {
      "type": "object",
      "properties": {
        "abstract_min": { "type": "number" },
        "concrete_max": { "type": "number" }
      },
      "required": ["abstract_min", "concrete_max"],
      "additionalProperties": false
    },
    "CohesionThresholds": {
      "type": "object",
      "properties": { "high_gt": { "type": "number" } },
      "required": ["high_gt"],
      "additionalProperties": false
    },
    "InstabilityThresholds": {
      "type": "object",
      "properties": {
        "unstable_min": { "type": "number" },
        "stable_max": { "type": "number" }
      },
      "required": ["unstable_min", "stable_max"],
      "additionalProperties": false
    },
    "DistanceThresholds": {
      "type": "object",
      "properties": {
        "good_max": { "type": "number" },
        "bad_min": { "type": "number" }
      },
      "required": ["good_max", "bad_min"],
      "additionalProperties": false
    }
  }
}
