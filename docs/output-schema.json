{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "cargo-anatomy output",
  "description": "Schema for the JSON/YAML output generated by the cargo-anatomy CLI",
  "type": "array",
  "items": {
    "type": "array",
    "minItems": 2,
    "maxItems": 2,
    "items": [
      { "type": "string", "description": "Package name" },
      { "oneOf": [ { "$ref": "#/definitions/Metrics" }, { "$ref": "#/definitions/CrateDetail" } ] }
    ]
  },
  "definitions": {
    "Metrics": {
      "type": "object",
      "properties": {
        "r": { "type": "integer", "description": "Number of internal class relationships" },
        "n": { "type": "integer", "description": "Number of classes" },
        "h": { "type": "number", "description": "Relational cohesion" },
        "ca": { "type": "integer", "description": "Afferent coupling" },
        "ce": { "type": "integer", "description": "Efferent coupling" },
        "a": { "type": "number", "description": "Abstraction" },
        "i": { "type": "number", "description": "Instability" },
        "d": { "type": "number", "description": "Distance from main sequence" },
        "d_prime": { "type": "number", "description": "Normalized distance from main sequence" }
      },
      "required": ["r", "n", "h", "ca", "ce", "a", "i", "d", "d_prime"],
      "additionalProperties": false
    },
    "ClassKind": {
      "type": "string",
      "enum": ["Struct", "Enum", "Trait", "TypeAlias", "Macro"]
    },
    "ClassInfo": {
      "type": "object",
      "properties": {
        "name": { "type": "string" },
        "kind": { "$ref": "#/definitions/ClassKind" }
      },
      "required": ["name", "kind"],
      "additionalProperties": false
    },
    "CrateKind": {
      "type": "string",
      "enum": ["Workspace", "External"]
    },
    "StringArrayMap": {
      "type": "object",
      "additionalProperties": { "type": "array", "items": { "type": "string" } }
    },
    "NestedStringArrayMap": {
      "type": "object",
      "additionalProperties": {
        "type": "object",
        "additionalProperties": { "type": "array", "items": { "type": "string" } }
      }
    },
    "CrateDetail": {
      "type": "object",
      "properties": {
        "kind": { "$ref": "#/definitions/CrateKind" },
        "metrics": { "$ref": "#/definitions/Metrics" },
        "classes": {
          "type": "array",
          "items": { "$ref": "#/definitions/ClassInfo" }
        },
        "internal_depends_on": { "$ref": "#/definitions/StringArrayMap" },
        "internal_depended_by": { "$ref": "#/definitions/StringArrayMap" },
        "external_depends_on": { "$ref": "#/definitions/NestedStringArrayMap" },
        "external_depended_by": { "$ref": "#/definitions/NestedStringArrayMap" }
      },
      "required": [
        "kind",
        "metrics",
        "classes",
        "internal_depends_on",
        "internal_depended_by",
        "external_depends_on",
        "external_depended_by"
      ],
      "additionalProperties": false
    }
  }
}
